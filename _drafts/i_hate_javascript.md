---
layout: post
title:  "I hate JavaScript"
date:   2015-07-18 23:46:52
categories: javascript
---

<a name="intro">[אני שונא javascript](#intro)
=======================================================

הסיפור מתחיל בחדר שינה באירלנד, שני גברים בשנות העשרים שלהם נמצאים במיטה בשעה חד-ספרתית בלילה.
האחד יכול לשמוע את נשימתו של האחר. זה לא היה יכול ללכת לשום כיוון אחר, זה היה חייב לקרות בשלב מסוים.

לאחר יום ארוך עם הרבה אוכל טוב, טיול רגלי בדבלין, בירות ושעות שיחה רבות, נכנסנו לדירה השכורה שלנו מ airbnb והתכוננו ללכת לישון.
זה קרה בזמן שחיכינו למקלחת, הגיעה הודעה בדבר פרויקט גמר ב android. לא היה צריך הרבה כדי להצית את הוויכוח הזה שוב -
 
- האם השוק הולך לכיוון של פיתוח אפליקציות עבור פלטפורמות ספציפיות או לכיוון של פיתוח אפליקציות cross-platform בעזרת כלים כמו phonegap?	

כמעט בתזמון מושלם, פייסבוק פרסמה את הספריה החדשה שלה ונתנה לי בסיס לטיעונים שלי.

> <div style="direction:rtl"> `react-native` היא ספריה אשר מאפשרת למתכנת לכתוב בשפה אחת ולהפיץ את המוצר למספר פלטפורמות. יש מספר טכנולוגיות קיימות בשוק, רוב הפתרונות מכוונים לכיוון של טכנולוגיות web. </div>

למי שמעוניין, להלן מספר תשתיות שמטרתן לכתוב קוד פעם אחת ולהפיץ למספר פלטפורמות:

> [phonegap](http://phonegap.com/), [ionic](http://ionicframework.com/), [xamarine](https://xamarin.com/) and [react-native](https://facebook.github.io/react-native/)

<a name="the problem">[הבעיה - מודולריות](#the_problem)
=======================================================

רציתי לבחון את react-native כי היא נשמעה לי מעניינת. היא מבוססת על ספריה אחרת בשם [`react`](https://facebook.github.io/react/index.html) .`react` היא הספריה לניהול תצוגה שפייסבוק פרסמה הרבה לפני `react-native`, לדבריהם - היא אמורה להיות ה `v` ב `mvc`.

הספריה אמורה להיות מאוד מאוד פשוטה, ואחרי קצת משחק איתה, היא באמת כזו. על רגל אחת - פייסבוק הגדירו שפה חדשה בשם `JSX` שמשתמשים בה על מנת להגדיר אלמנטים גרפיים. לדוגמא:


~~~
React.render(
<h1> Hello, world!</h1>,
document.getElementById('example')
);
~~~

לא אכביר במילים, הקוד הבא נכתב ב javascript והוא מוסיף תגית "<h1>" לתוך אובייקט `DOM` בשם `example`. עם זאת, להלן דברים שעצבנו אותי:

* העורך הטקסט שלי visual studio code, ממש נדפק בגלל react. חלוקה לקבצים הייתה פותרת לי את זה, כי רק קובץ קטן היה נדפק ולא כל הקוד.

> <div style="direction:rtl"> ואני מבין אותו, מיקומן של תגיות XML הוא לא בתוך קוד JS (הן אפילו לא בתוך מרכאות..)</div>

*  כתבתי את כל הקוד בקובץ אחד, מה שגרם להרבה בלאגן.

לא ידעתי איך להפריד לקבצים בצורה נכונה, זה לא כמו לרכב על אופניים, לא לומדים את זה בשפה אחת וזה תקף לכולן. הכרזה על קבצים נוספים נעשית דרך תגית `<script>` (והסדר בין התלויות משנה), במקרה הזה החלטתי שזה לא מתאים לי.

הסיבה שלא רציתי ללנקג' בצורה כזו היא כי עבדתי על ספריה - לא מצתי דרך לעשות את זה דרך javascript בלי לערב html ולא רציתי שהמשתמש של הספריה יכיר קבצים פנימיים ואת הסדר שלהם. כמו כן לא רציתי לעשות squash לקובץ אחד גדול.

> <div style="direction:rtl"> הערה חשובה - אני לא אכנס כאן לפרטים טכניים עמוקים, משתי סיבות - הראשונה אני כותב בעברית. הסיבה השניה היא שאני מנסה להעביר את הרעיון הכללי ולשמור על כתיבה קלה וזורמת. עם זאת, אני אספק מקורות קריאה נוספים שנעזרתי בהם למי שמעוניין להיכנס לעומק הבעיה.</div>


<a name="the problem">[הפתרון המגניב - Design Pattern](#old_solution)
=======================================================

אז אחרי מספר נסיונות פשוטים למדי לפתור את הבעיה עם הידע המצומצם שלי ב JS וכוס תה אחת, התחלתי לחפש את הבעיה בגוגל. מהר מאוד מצאתי פתרון שנקרא `Module Pattern`. במבט ראשון - פותר את הבעיה. כבונוס, ה pattern פותר גם את בעיית ה global scope של JS:

~~~
var Module = (function(public_api){
  var this_is_a_var = 3;
  
  public_api.getAVar = function() { return this_is_a_var } 

  return public_api;
} (Module));

console.log(Module.getAVar());

~~~

החלק החשוב בקוד הזה הוא שעד כה, היינו מגדירים פונקציות על ה scope הגלובאלי ואילו כאן, הפונקציות מוגדרות על אובייקט מסוים. כשנרצה להשתמש בפונקציות שכתבנו, נצטרך לגשת אליהן דרך המודול שלנו. ספריות חיצוניות רבות משתמשות בשיטות הללו - ניתן למצוא דוגמאות רבות לספריות open-source:


* jquery.js משתמשת בסימן $ עבור שם המודול
* underscore משתמשת בסימן, ובכן - '_' עבור שם המודול שלה

ניתן לקרוא עוד - [פה.](http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html) 

הפתרון הזה מאפשר להפריד לקבצים ופותר יחסית לרמה טובה את בעית הזיבול של ה scope הגלובאלי, אבל עדיין מציקה לי העובדה שצריך להשתמש בתגיות `<script>` ויש תלות בסדר שלהן.

<a name="the problem">[הפתרון שעובד - require & browserify](#new_solution)
=======================================================

ידעתי שהפתרון שאני צריך קשור לספריה לניהול תלויות, אבל עכשיו כל החתיכות התחברו לי. נתחיל מזה ש node יודע לעשות את כל מה שאני צריך ע"י הפונקציה require שמגדירה את התלויות בין המודולים.

אבל node לא ממש עוזר לי, כי הוא לא רץ על הדפדפן. ובכן, לא מדויק, בשביל זה בדיוק המציאו את [browserify](https://lincolnloop.com/blog/untangle-your-javascript-browserify/) (אגב, ממליץ להשתמש דווקא ב [watchify](https://github.com/substack/watchify), שמאפשר עבודה אוטומטית יותר)

הפתרון ש require נותן הוא בעצם להגדיר את התלויות שלנו בתוך הקובץ js עצמו, ולא בתוך קובץ ה html. יש לזה משמעות עצומה בעיקר כי עכשיו ניתן:

1. להסתיר מהמשתמש את הקבצים הפנימיים של הספריה
2. להסיר את דאגת המשתמש לגבי סדר התלויות
3. להשתמש בכלים מגניבים. סתם, לא באמת... הם ממש מגניבים :)

שוב, לא אכנס פה לפרטים יותר טכניים, יש אנשים שעשו את זה [טוב ממני](https://scott.mn/2014/03/03/javascript_modules/).

<a name="the problem">[סוף דבר](#summery)
=======================================================
התחלתי את הבלוג בלכתוב שאני שונא javascript. כל הבעיה המתוארת פה לא הייתה מתרחשת אם היה מדובר ב c או java.
שם ניתן להגדיר ברמת הספריה באילו קבצים הספריה משתמשת ואת סדר התלויות בהן. וכן, זה מוגדר בספריה עצמה, ולא אצל מי שמשתמש בספריה.
כמו כן, בעיית הגלובאלים נפתרה כבר בשפות רבות אחרות ( ע"י namespaces לדוגמא), אך ב javascript היא עדיין קיימת.

עם זאת, אני ממליץ לכל מי שעדיין לא יודע JS, ללכת עכשיו וללמוד אותה. חוץ מזו שזו השפה שהכי תופסת תאוצה בשוק היום - שווה להכיר אותה על מנת להרחיב אופקים ולפתוח את הראש לדרך חשיבה נוספת, גם אם היא דפוקה.


בסופו של דבר, הקוד שלי עדיין לא עובד. אבל עכשיו יש לי blog post ארוך בנושא :)

אשמח לשמוע את דעתכם, עדיין אין לי אופציה לתיבת תגובות, אבל מייל זו תמיד אפשרות.
